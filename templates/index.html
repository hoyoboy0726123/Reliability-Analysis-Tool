<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Reliability Calculator</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>

    <!-- AF Result Responsive Font Size -->
    <style>
        .af-result-value {
            word-break: break-word;
            overflow-wrap: break-word;
            line-height: 1.1;
            transition: font-size 0.2s ease;
        }
    </style>
</head>

<body class="dark-theme">

    <div class="container-fluid py-4">
        <header class="mb-5 text-center">
            <h1 class="display-5 fw-bold text-gradient">Reliability Analysis Suite</h1>
            <p class="text-muted">加速壽命測試 (ALT) · Weibull 分析 · 零失效評估</p>
            <div class="mt-3">
                <a href="/guide" class="btn btn-outline-info btn-sm">
                    📚 參數設定指南
                </a>
            </div>
        </header>

        <div class="row g-4">
            <!-- 左側：輸入面板 -->
            <div class="col-lg-4">
                <div class="card glass-panel h-100">
                    <div class="card-header border-0">
                        <ul class="nav nav-tabs card-header-tabs" id="inputTabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="af-tab" data-bs-toggle="tab" href="#af-panel"
                                    role="tab">1. 加速模型</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="data-tab" data-bs-toggle="tab" href="#data-panel" role="tab">2.
                                    測試數據</a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body tab-content">

                        <!-- Tab 1: AF Parameters -->
                        <div class="tab-pane fade show active" id="af-panel" role="tabpanel">
                            <h6 class="text-uppercase text-white mb-3">
                                <span class="me-2">📊</span>加速因子選擇 (ACCELERATION FACTORS)
                            </h6>
                            <div class="mb-4 p-3 bg-dark bg-opacity-25 rounded">
                                <div class="row g-3">
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable_temp" checked onchange="toggleAFSection('temp')">
                                            <label class="form-check-label" for="enable_temp">
                                                <strong class="text-white">溫度 (Temperature)</strong>
                                                <div class="small text-warning">Arrhenius 模型</div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable_hum" checked onchange="toggleAFSection('hum')">
                                            <label class="form-check-label" for="enable_hum">
                                                <strong class="text-white">濕度 (Humidity)</strong>
                                                <div class="small text-warning">Peck 模型</div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable_voltage" onchange="toggleAFSection('voltage')">
                                            <label class="form-check-label" for="enable_voltage">
                                                <strong class="text-white">電壓 (Voltage)</strong>
                                                <div class="small text-warning">指數模型</div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable_tc" onchange="toggleAFSection('tc')">
                                            <label class="form-check-label" for="enable_tc">
                                                <strong class="text-white">熱循環 (Thermal Cycling)</strong>
                                                <div class="small text-warning">Coffin-Manson 模型</div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable_vib" onchange="toggleAFSection('vib')">
                                            <label class="form-check-label" for="enable_vib">
                                                <strong class="text-white">機械振動 (Vibration)</strong>
                                                <div class="small text-warning">逆冪律模型</div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable_uv" onchange="toggleAFSection('uv')">
                                            <label class="form-check-label" for="enable_uv">
                                                <strong class="text-white">紫外線輻射 (UV Radiation)</strong>
                                                <div class="small text-warning">實驗比對模型</div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable_chem" onchange="toggleAFSection('chem')">
                                            <label class="form-check-label" for="enable_chem">
                                                <strong class="text-white">化學濃度 (Chemical)</strong>
                                                <div class="small text-warning">逆冪律模型</div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable_eyring" onchange="toggleEyringMode()">
                                            <label class="form-check-label" for="enable_eyring">
                                                <strong class="text-white">⚙️ Eyring 模型 (應力交互)</strong>
                                                <div class="small text-warning">適用於高可靠度產品<br>⚠️ 需實驗數據確定參數 D</div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable_rad" onchange="toggleAFSection('rad')">
                                            <label class="form-check-label" for="enable_rad">
                                                <strong class="text-white">輻射劑量 (Radiation)</strong>
                                                <div class="small text-warning">僅適用於太空/核環境</div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Eyring 參數區 -->
                            <div id="eyring_section" style="display:none;">
                                <h6 class="text-uppercase text-white mb-3">
                                    <span class="me-2">⚙️</span>EYRING 交互作用參數
                                </h6>
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <label class="form-label text-white">主要應力類型</label>
                                        <select class="form-select" id="eyring_stress_type">
                                            <option value="voltage">電壓 (Voltage)</option>
                                            <option value="humidity">濕度 (Humidity)</option>
                                        </select>
                                        <div class="form-text text-warning small">選擇與溫度有交互作用的應力</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">交互作用參數 D</label>
                                        <input type="number" class="form-control" id="eyring_d" value="0.1" step="0.01">
                                        <div class="form-text text-warning small">需通過實驗擬合確定</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">模型常數 A</label>
                                        <input type="number" class="form-control" id="eyring_a" value="1000" step="10">
                                        <div class="form-text text-warning small">生命常數（實驗擬合）</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">應力指數 B</label>
                                        <input type="number" class="form-control" id="eyring_b" value="2.0" step="0.1">
                                        <div class="form-text text-warning small">非熱應力的冪次</div>
                                    </div>
                                </div>
                            </div>

                            <h6 class="text-uppercase text-white mb-3">現場使用條件 (USE CONDITIONS)</h6>
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <label class="form-label text-white">溫度 (°C)</label>
                                    <input type="number" class="form-control" id="t_use" value="32">
                                </div>
                                <div class="col-6">
                                    <label class="form-label text-white">濕度 (%RH)</label>
                                    <input type="number" class="form-control" id="rh_use" value="60">
                                </div>
                            </div>

                            <h6 class="text-uppercase text-white mb-3">加速測試條件 (ALT CONDITIONS)</h6>
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <label class="form-label text-white">溫度 (°C)</label>
                                    <input type="number" class="form-control" id="t_alt" value="70">
                                </div>
                                <div class="col-6">
                                    <label class="form-label text-white">濕度 (%RH)</label>
                                    <input type="number" class="form-control" id="rh_alt" value="90">
                                </div>
                            </div>

                            <!-- 電壓參數 -->
                            <div id="voltage_section" style="display:none;">
                                <h6 class="text-uppercase text-white mb-3">
                                    <span class="me-2">⚡</span>電壓參數 (VOLTAGE PARAMETERS)
                                </h6>
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <label class="form-label text-white">使用電壓 (V)</label>
                                        <input type="number" class="form-control" id="v_use" value="1.0" step="0.1">
                                        <div class="form-text text-warning small">典型操作電壓</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">測試電壓 (V)</label>
                                        <input type="number" class="form-control" id="v_alt" value="1.0" step="0.1">
                                        <div class="form-text text-warning small">加速測試電壓</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">電壓指數 β</label>
                                        <input type="number" class="form-control" id="beta_v" value="1.0" step="0.1">
                                        <div class="form-text text-warning small">典型值：1.0 (逆冪律模型)</div>
                                    </div>
                                </div>
                            </div>

                            <h6 class="text-uppercase text-white mb-3">模型常數 (CONSTANTS)</h6>
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <label class="form-label text-white">活化能 Ea (eV)</label>
                                    <select class="form-select" id="ea_select" onchange="handleEaSelectChange()">
                                        <option value="0.7">通用默認 (0.7 eV) - 業界標準</option>
                                        <option value="0.9">半導體 IC - 高性能 (0.9 eV)</option>
                                        <option value="0.6">半導體 IC - 一般 (0.6 eV)</option>
                                        <option value="1.2">封裝鍵合線 (1.2 eV)</option>
                                        <option value="0.8">電阻器 (0.8 eV)</option>
                                        <option value="0.7_cap">電容器 (0.7 eV)</option>
                                        <option value="0.6_solder">焊點 (0.6 eV)</option>
                                        <option value="custom">自行輸入...</option>
                                    </select>
                                    <input type="number" class="form-control mt-2 d-none" id="ea" value="0.7" step="0.1" placeholder="請輸入 Ea 值 (eV)">
                                    <div class="form-text text-warning small">選擇元件類型或自行輸入活化能</div>
                                </div>
                                <div class="col-6">
                                    <label class="form-label text-white">濕度 n</label>
                                    <input type="number" class="form-control" id="n_hum" value="2.0" step="0.1">
                                </div>
                            </div>

                            <!-- 熱循環參數 -->
                            <div id="tc_section" style="display:none;">
                                <h6 class="text-uppercase text-white mb-3">
                                    <span class="me-2">🔄</span>熱循環參數 (THERMAL CYCLING PARAMETERS)
                                </h6>
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <label class="form-label text-white">使用 ΔT (°C)</label>
                                        <input type="number" class="form-control" id="dt_use" value="70" step="1">
                                        <div class="form-text text-warning small">例：0°C ~ 70°C = 70°C</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">測試 ΔT (°C)</label>
                                        <input type="number" class="form-control" id="dt_alt" value="165" step="1">
                                        <div class="form-text text-warning small">例：-40°C ~ 125°C = 165°C (JEDEC)</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">使用頻率 (cycles/hr)</label>
                                        <input type="number" class="form-control" id="f_use" value="0.042" step="0.001">
                                        <div class="form-text text-warning small">預設：每天開關機1次 (1÷24hr = 0.042)</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">測試頻率 (cycles/hr)</label>
                                        <input type="number" class="form-control" id="f_alt" value="2" step="0.1">
                                        <div class="form-text text-warning small">預設：每小時2次 (30分鐘/循環)</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">頻率指數 α</label>
                                        <input type="number" class="form-control" id="alpha_tc" value="0.33" step="0.01">
                                        <div class="form-text text-warning small">典型值：0.33 (焊點)</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">溫度指數 β</label>
                                        <input type="number" class="form-control" id="beta_tc" value="1.9" step="0.1">
                                        <div class="form-text text-warning small">典型值：1.9 (焊點), 5.0-6.0 (陶瓷)</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 振動參數 -->
                            <div id="vib_section" style="display:none;">
                                <h6 class="text-uppercase text-white mb-3">
                                    <span class="me-2">📳</span>機械振動參數 (VIBRATION PARAMETERS)
                                </h6>
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <label class="form-label text-white">使用加速度 (g)</label>
                                        <input type="number" class="form-control" id="g_use" value="1.0" step="0.1">
                                        <div class="form-text text-warning small">一般使用環境：0.5-2.0g</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">測試加速度 (g)</label>
                                        <input type="number" class="form-control" id="g_alt" value="20" step="1">
                                        <div class="form-text text-warning small">JEDEC標準：10-20g</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">功率指數 n</label>
                                        <input type="number" class="form-control" id="n_vib" value="8.0" step="0.1">
                                        <div class="form-text text-warning small">典型值：8.0 (焊點振動疲勞)</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 紫外線輻射參數 -->
                            <div id="uv_section" style="display:none;">
                                <h6 class="text-uppercase text-white mb-3">
                                    <span class="me-2">☀️</span>紫外線輻射參數 (UV RADIATION PARAMETERS)
                                </h6>
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <label class="form-label text-white">現場暴露時間 (小時)</label>
                                        <input type="number" class="form-control" id="t_field_uv" value="8760" step="100">
                                        <div class="form-text text-warning small">預設：1年 = 8760小時</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">加速測試時間 (小時)</label>
                                        <input type="number" class="form-control" id="t_accel_uv" value="1000" step="10">
                                        <div class="form-text text-warning small">達到相同退化的測試時間</div>
                                    </div>
                                    <div class="col-12">
                                        <div class="alert alert-info small mb-0">
                                            <strong>注意：</strong>UV加速因子需通過實驗比對確定，需控制光譜輸出、溫度和濕度
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 化學濃度參數 -->
                            <div id="chem_section" style="display:none;">
                                <h6 class="text-uppercase text-white mb-3">
                                    <span class="me-2">🧪</span>化學濃度參數 (CHEMICAL CONCENTRATION PARAMETERS)
                                </h6>
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <label class="form-label text-white">使用濃度 (相對單位)</label>
                                        <input type="number" class="form-control" id="c_use" value="1.0" step="0.1">
                                        <div class="form-text text-warning small">標準使用環境濃度（基準值）</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">測試濃度 (相對單位)</label>
                                        <input type="number" class="form-control" id="c_alt" value="5.0" step="0.1">
                                        <div class="form-text text-warning small">加速測試濃度</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">功率指數 n</label>
                                        <input type="number" class="form-control" id="n_chem" value="2.0" step="0.1">
                                        <div class="form-text text-warning small">典型值：1.5-3.0 (腐蝕/降解)</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 輻射劑量參數 -->
                            <div id="rad_section" style="display:none;">
                                <h6 class="text-uppercase text-white mb-3">
                                    <span class="me-2">☢️</span>輻射劑量參數 (RADIATION DOSE PARAMETERS)
                                </h6>
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <label class="form-label text-white">使用環境累積劑量 (krad)</label>
                                        <input type="number" class="form-control" id="d_use" value="10" step="1">
                                        <div class="form-text text-warning small">任務期間累積總游離劑量 (TID)</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">測試累積劑量 (krad)</label>
                                        <input type="number" class="form-control" id="d_alt" value="100" step="10">
                                        <div class="form-text text-warning small">輻射加速測試劑量</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">劑量率 (krad/hr)</label>
                                        <input type="number" class="form-control" id="dose_rate" value="50" step="10">
                                        <div class="form-text text-warning small">測試劑量率（影響失效機制）</div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label text-white">劑量敏感度指數 n</label>
                                        <input type="number" class="form-control" id="n_rad" value="1.0" step="0.1">
                                        <div class="form-text text-warning small">典型值：0.5-2.0 (器件相關)</div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Tab 2: Test Data -->
                        <div class="tab-pane fade" id="data-panel" role="tabpanel">
                            <div class="mb-3">
                                <label class="form-label text-warning">任務時間 (Mission Time) [年]</label>
                                <input type="number" class="form-control border-info" id="mission_years" value="2" step="0.5" min="0.5">
                                <div class="form-text text-warning small">用於計算可靠度 R(t) 與結論</div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label text-white">總樣品數 (N)</label>
                                <input type="number" class="form-control" id="n_samples" value="64">
                            </div>

                            <hr class="border-secondary">

                            <h6 class="text-uppercase text-white mb-2">情境 A: 有失效數據 (WEIBULL)</h6>
                            <p class="small text-warning mb-1">輸入失效時間 (TTF)，以逗號或空格分隔。</p>
                            <p class="small text-warning mb-2">⚠️ 至少需要 <strong>2 個</strong>失效時間才能進行 Weibull 分析 (建議 5 個以上)</p>
                            <textarea class="form-control font-monospace mb-3" id="failures_input" rows="5"
                                placeholder="例如: 100, 150, 200, 250, 300 (至少 2 個)"></textarea>

                            <div class="row g-2 mb-3">
                                <div class="col-4">
                                    <label class="form-label text-white small">中位秩方法</label>
                                    <select class="form-select form-select-sm" id="median_rank_method">
                                        <option value="benard" selected>Benard's (推薦)</option>
                                        <option value="exact">精確中位秩</option>
                                        <option value="mean">平均秩</option>
                                    </select>
                                    <div class="form-text text-warning small">Benard's 最常用</div>
                                </div>
                                <div class="col-4">
                                    <label class="form-label text-white small">回歸方法</label>
                                    <select class="form-select form-select-sm" id="regression_method">
                                        <option value="rry" selected>RRY (推薦)</option>
                                        <option value="rrx">RRX</option>
                                        <option value="mle">MLE (最優)</option>
                                    </select>
                                    <div class="form-text text-warning small">n<15 用 RRY，n≥15 用 MLE</div>
                                </div>
                                <div class="col-4">
                                    <label class="form-label text-white small">Bx% 壽命計算</label>
                                    <select class="form-select form-select-sm" id="bx_life_percent">
                                        <option value="1" selected>B1% (早期失效)</option>
                                        <option value="10">B10% (機械工程)</option>
                                        <option value="50">B50% (中位壽命)</option>
                                    </select>
                                    <div class="form-text text-warning small">B1% 為預設</div>
                                </div>
                            </div>

                            <hr class="border-secondary">

                            <h6 class="text-uppercase text-white mb-2">情境 B: 零失效 (ZERO-FAILURE)</h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <label class="form-label text-white">測試時長 (Hrs)</label>
                                    <input type="number" class="form-control" id="t_test" value="1196">
                                </div>
                                <div class="col-6">
                                    <label class="form-label text-white">信心水準 (0-1)</label>
                                    <input type="number" class="form-control" id="cl" value="0.6" step="0.05">
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="card-footer border-0 bg-transparent">
                        <button class="btn btn-primary w-100 btn-lg shadow-primary" onclick="calculate()">
                            <span class="me-2">⚡</span> 開始計算 (Calculate)
                        </button>
                    </div>
                </div>
            </div>

            <!-- 右側：結果儀表板 -->
                    <div class="col-lg-8">
                        <!-- 1. 加速因子結果 -->
                        <div class="row g-3 mb-4" id="af_results_container">
                            <div class="col-md-3 col-lg-2">
                                <div class="card glass-card text-center p-3">
                                    <div class="text-muted small">AF (Temp)</div>
                                    <div class="h4 mb-0 text-white af-result-value" id="res_af_t">-</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-2">
                                <div class="card glass-card text-center p-3">
                                    <div class="text-muted small">AF (Humidity)</div>
                                    <div class="h4 mb-0 text-white af-result-value" id="res_af_rh">-</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-2" id="af_v_card" style="display:none;">
                                <div class="card glass-card text-center p-3">
                                    <div class="text-muted small">AF (Voltage)</div>
                                    <div class="h4 mb-0 text-white af-result-value" id="res_af_v">-</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-2" id="af_tc_card" style="display:none;">
                                <div class="card glass-card text-center p-3">
                                    <div class="text-muted small">AF (T-Cycle)</div>
                                    <div class="h4 mb-0 text-white af-result-value" id="res_af_tc">-</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-2" id="af_vib_card" style="display:none;">
                                <div class="card glass-card text-center p-3">
                                    <div class="text-muted small">AF (Vibration)</div>
                                    <div class="h4 mb-0 text-white af-result-value" id="res_af_vib">-</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-2" id="af_uv_card" style="display:none;">
                                <div class="card glass-card text-center p-3">
                                    <div class="text-muted small">AF (UV)</div>
                                    <div class="h4 mb-0 text-white af-result-value" id="res_af_uv">-</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-2" id="af_chem_card" style="display:none;">
                                <div class="card glass-card text-center p-3">
                                    <div class="text-muted small">AF (Chemical)</div>
                                    <div class="h4 mb-0 text-white af-result-value" id="res_af_chem">-</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-2" id="af_rad_card" style="display:none;">
                                <div class="card glass-card text-center p-3">
                                    <div class="text-muted small">AF (Radiation)</div>
                                    <div class="h4 mb-0 text-white af-result-value" id="res_af_rad">-</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-2">
                                <div class="card glass-card bg-primary-gradient text-center p-3">
                                    <div class="text-white-50 small">AF Total</div>
                                    <div class="h3 mb-0 text-white fw-bold af-result-value" id="res_af_total">-</div>
                                </div>
                            </div>
                        </div>

                        <!-- 2. 分析結果 (Weibull & Zero-Failure) -->
                        <div class="row g-4">
                            <!-- Weibull Chart & Stats -->
                            <div class="col-md-12">
                                <div class="card glass-panel">
                                    <div class="card-header border-0 d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">可靠度分析結果</h5>
                                        <span class="badge bg-secondary" id="analysis_mode_badge">Waiting for
                                            input...</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <!-- 結果數據列表 -->
                                            <div class="col-md-4 border-end border-secondary">
                                                <h6 class="text-muted text-uppercase small mb-3">現場壽命推算 (Field Life)
                                                </h6>

                                                <!-- Weibull Results -->
                                                <div id="weibull_stats" class="d-none">
                                                    <div class="mb-3">
                                                        <label class="small text-muted">MTTF (Mean Life)</label>
                                                        <div class="h5 text-info" id="wb_mttf">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="small text-muted" id="wb_bx_label">B1% Life</label>
                                                        <div class="h5 text-warning" id="wb_b1">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="small text-muted" id="wb_rel_label">Reliability (2 Years)</label>
                                                        <div class="h5 text-success" id="wb_rel">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="small text-muted">等效現場時間 (Equivalent Field Time)</label>
                                                        <div class="h5 text-primary" id="wb_eq_time">-</div>
                                                        <div class="small text-warning" id="wb_eq_detail">-</div>
                                                    </div>
                                                    <hr>
                                                    <div class="small text-muted">Params: β=<span id="wb_beta">-</span>,
                                                        η=<span id="wb_eta">-</span></div>
                                                </div>

                                                <!-- Zero Failure Results -->
                                                <div id="zf_stats" class="d-none">
                                                    <div class="mb-3">
                                                        <label class="small text-muted">MTTF (Lower Limit)</label>
                                                        <div class="h5 text-info" id="zf_mttf">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="small text-muted">Max Failure Rate (FITs)</label>
                                                        <div class="h5 text-danger" id="zf_lambda">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="small text-muted" id="zf_rel_label">Reliability (2 Years)</label>
                                                        <div class="h5 text-success" id="zf_rel">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="small text-muted">等效現場時間 (Equivalent Field Time)</label>
                                                        <div class="h5 text-primary" id="zf_eq_time">-</div>
                                                        <div class="small text-warning" id="zf_eq_detail">-</div>
                                                    </div>
                                                    <hr>
                                                    <div class="small text-muted">Based on Chi-Squared (CL=<span
                                                            id="zf_cl_display">-</span>)</div>
                                                </div>
                                            </div>

                                            <!-- 圖表區域 (Chart Area) -->
                                            <div class="col-md-8">
                                                <!-- 圖表切換按鈕 -->
                                                <div class="d-flex justify-content-end mb-2">
                                                    <div class="btn-group btn-group-sm" role="group">
                                                        <input type="radio" class="btn-check" name="chartType"
                                                            id="btn_rel" autocomplete="off" checked
                                                            onclick="switchChart('reliability')">
                                                        <label class="btn btn-outline-info" for="btn_rel">Reliability
                                                            R(t)</label>

                                                        <input type="radio" class="btn-check" name="chartType"
                                                            id="btn_haz" autocomplete="off"
                                                            onclick="switchChart('hazard')">
                                                        <label class="btn btn-outline-danger" for="btn_haz">Failure Rate
                                                            h(t)</label>

                                                        <input type="radio" class="btn-check" name="chartType"
                                                            id="btn_pdf" autocomplete="off"
                                                            onclick="switchChart('pdf')">
                                                        <label class="btn btn-outline-warning" for="btn_pdf">PDF
                                                            f(t)</label>
                                                    </div>
                                                </div>

                                                <div id="plot_area" style="width:100%; height:400px;">
                                                    <!-- Plotly Chart -->
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 結論區塊 (Conclusion Panel) -->
                                        <div class="row mt-4">
                                            <div class="col-12">
                                                <div class="alert glass-card border-info" role="alert"
                                                    id="conclusion_panel" style="display: none;">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <h6 class="alert-heading fw-bold text-info mb-0">
                                                            <i class="bi bi-lightbulb-fill me-2"></i>分析結論 (Conclusion)
                                                        </h6>
                                                        <div class="btn-group" role="group">
                                                            <button type="button" class="btn btn-sm btn-info dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" id="generate_report_btn">
                                                                <i class="bi bi-file-earmark-text me-1"></i>生成測試報告
                                                            </button>
                                                            <ul class="dropdown-menu dropdown-menu-end">
                                                                <li>
                                                                    <a class="dropdown-item" href="#" onclick="generateReport('pdf'); return false;">
                                                                        <i class="bi bi-file-earmark-pdf me-2 text-danger"></i>PDF 格式
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a class="dropdown-item" href="#" onclick="generateReport('word'); return false;">
                                                                        <i class="bi bi-file-earmark-word me-2 text-primary"></i>Word 格式 (.docx)
                                                                    </a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <p class="mb-0 text-light" id="conclusion_text"
                                                        style="line-height: 1.6; font-size: 0.95rem;">
                                                        <!-- JS will inject text here -->
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bootstrap JS -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
            <!-- Custom JS -->
            <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>