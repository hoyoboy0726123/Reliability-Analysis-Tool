<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Reliability Calculator</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
</head>

<body class="dark-theme">

    <div class="container-fluid py-4">
        <header class="mb-5 text-center">
            <h1 class="display-5 fw-bold text-gradient">Reliability Analysis Suite</h1>
            <p class="text-muted">加速壽命測試 (ALT) · Weibull 分析 · 零失效評估</p>
        </header>

        <div class="row g-4">
            <!-- 左側：輸入面板 -->
            <div class="col-lg-4">
                <div class="card glass-panel h-100">
                    <div class="card-header border-0">
                        <ul class="nav nav-tabs card-header-tabs" id="inputTabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="af-tab" data-bs-toggle="tab" href="#af-panel"
                                    role="tab">1. 加速模型</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="data-tab" data-bs-toggle="tab" href="#data-panel" role="tab">2.
                                    測試數據</a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body tab-content">

                        <!-- Tab 1: AF Parameters -->
                        <div class="tab-pane fade show active" id="af-panel" role="tabpanel">
                            <h6 class="text-uppercase text-primary mb-3">現場使用條件 (Use Conditions)</h6>
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <label class="form-label">溫度 (°C)</label>
                                    <input type="number" class="form-control" id="t_use" value="32">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">濕度 (%RH)</label>
                                    <input type="number" class="form-control" id="rh_use" value="60">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">電壓 (V)</label>
                                    <input type="number" class="form-control" id="v_use" value="1.0">
                                </div>
                            </div>

                            <h6 class="text-uppercase text-danger mb-3">加速測試條件 (ALT Conditions)</h6>
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <label class="form-label">溫度 (°C)</label>
                                    <input type="number" class="form-control" id="t_alt" value="70">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">濕度 (%RH)</label>
                                    <input type="number" class="form-control" id="rh_alt" value="90">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">電壓 (V)</label>
                                    <input type="number" class="form-control" id="v_alt" value="1.0">
                                </div>
                            </div>

                            <h6 class="text-uppercase text-info mb-3">模型常數 (Constants)</h6>
                            <div class="row g-2 mb-3">
                                <div class="col-4">
                                    <label class="form-label">Ea (eV)</label>
                                    <input type="number" class="form-control" id="ea" value="1.0" step="0.1">
                                </div>
                                <div class="col-4">
                                    <label class="form-label">濕度 n</label>
                                    <input type="number" class="form-control" id="n_hum" value="2.0" step="0.1">
                                </div>
                                <div class="col-4">
                                    <label class="form-label">電壓 β</label>
                                    <input type="number" class="form-control" id="beta_v" value="1.0" step="0.1">
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: Test Data -->
                        <div class="tab-pane fade" id="data-panel" role="tabpanel">
                            <div class="mb-3">
                                <label class="form-label text-info">任務時間 (Mission Time) [年]</label>
                                <input type="number" class="form-control border-info" id="mission_years" value="2" step="0.5" min="0.5">
                                <div class="form-text text-muted small">用於計算可靠度 R(t) 與結論</div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">總樣品數 (N)</label>
                                <input type="number" class="form-control" id="n_samples" value="64">
                            </div>

                            <hr class="border-secondary">

                            <h6 class="text-uppercase text-warning mb-2">情境 A: 有失效數據 (Weibull)</h6>
                            <p class="small text-muted mb-1">輸入失效時間 (TTF)，以逗號或空格分隔。</p>
                            <p class="small text-warning mb-2">⚠️ 至少需要 <strong>2 個</strong>失效時間才能進行 Weibull 分析 (建議 5 個以上)</p>
                            <textarea class="form-control font-monospace mb-3" id="failures_input" rows="5"
                                placeholder="例如: 100, 150, 200, 250, 300 (至少 2 個)"></textarea>

                            <hr class="border-secondary">

                            <h6 class="text-uppercase text-success mb-2">情境 B: 零失效 (Zero-Failure)</h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <label class="form-label">測試時長 (Hrs)</label>
                                    <input type="number" class="form-control" id="t_test" value="1196">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">信心水準 (0-1)</label>
                                    <input type="number" class="form-control" id="cl" value="0.6" step="0.05">
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="card-footer border-0 bg-transparent">
                        <button class="btn btn-primary w-100 btn-lg shadow-primary" onclick="calculate()">
                            <span class="me-2">⚡</span> 開始計算 (Calculate)
                        </button>
                    </div>
                </div>
            </div>

            <!-- 右側：結果儀表板 -->
                    <div class="col-lg-8">
                        <!-- 1. 加速因子結果 -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card glass-card text-center p-3">
                                    <div class="text-muted small">AF (Temp)</div>
                                    <div class="h4 mb-0 text-white" id="res_af_t">-</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card glass-card text-center p-3">
                                    <div class="text-muted small">AF (Humidity)</div>
                                    <div class="h4 mb-0 text-white" id="res_af_rh">-</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card glass-card text-center p-3">
                                    <div class="text-muted small">AF (Voltage)</div>
                                    <div class="h4 mb-0 text-white" id="res_af_v">-</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card glass-card bg-primary-gradient text-center p-3">
                                    <div class="text-white-50 small">AF Total</div>
                                    <div class="h3 mb-0 text-white fw-bold" id="res_af_total">-</div>
                                </div>
                            </div>
                        </div>

                        <!-- 2. 分析結果 (Weibull & Zero-Failure) -->
                        <div class="row g-4">
                            <!-- Weibull Chart & Stats -->
                            <div class="col-md-12">
                                <div class="card glass-panel">
                                    <div class="card-header border-0 d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">可靠度分析結果</h5>
                                        <span class="badge bg-secondary" id="analysis_mode_badge">Waiting for
                                            input...</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <!-- 結果數據列表 -->
                                            <div class="col-md-4 border-end border-secondary">
                                                <h6 class="text-muted text-uppercase small mb-3">現場壽命推算 (Field Life)
                                                </h6>

                                                <!-- Weibull Results -->
                                                <div id="weibull_stats" class="d-none">
                                                    <div class="mb-3">
                                                        <label class="small text-muted">MTTF (Mean Life)</label>
                                                        <div class="h5 text-info" id="wb_mttf">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="small text-muted">B1% Life</label>
                                                        <div class="h5 text-warning" id="wb_b1">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="small text-muted" id="wb_rel_label">Reliability (2 Years)</label>
                                                        <div class="h5 text-success" id="wb_rel">-</div>
                                                    </div>
                                                    <hr>
                                                    <div class="small text-muted">Params: β=<span id="wb_beta">-</span>,
                                                        η=<span id="wb_eta">-</span></div>
                                                </div>

                                                <!-- Zero Failure Results -->
                                                <div id="zf_stats" class="d-none">
                                                    <div class="mb-3">
                                                        <label class="small text-muted">MTTF (Lower Limit)</label>
                                                        <div class="h5 text-info" id="zf_mttf">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="small text-muted">Max Failure Rate (FITs)</label>
                                                        <div class="h5 text-danger" id="zf_lambda">-</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="small text-muted" id="zf_rel_label">Reliability (2 Years)</label>
                                                        <div class="h5 text-success" id="zf_rel">-</div>
                                                    </div>
                                                    <hr>
                                                    <div class="small text-muted">Based on Chi-Squared (CL=<span
                                                            id="zf_cl_display">-</span>)</div>
                                                </div>
                                            </div>

                                            <!-- 圖表區域 (Chart Area) -->
                                            <div class="col-md-8">
                                                <!-- 圖表切換按鈕 -->
                                                <div class="d-flex justify-content-end mb-2">
                                                    <div class="btn-group btn-group-sm" role="group">
                                                        <input type="radio" class="btn-check" name="chartType"
                                                            id="btn_rel" autocomplete="off" checked
                                                            onclick="switchChart('reliability')">
                                                        <label class="btn btn-outline-info" for="btn_rel">Reliability
                                                            R(t)</label>

                                                        <input type="radio" class="btn-check" name="chartType"
                                                            id="btn_haz" autocomplete="off"
                                                            onclick="switchChart('hazard')">
                                                        <label class="btn btn-outline-danger" for="btn_haz">Failure Rate
                                                            h(t)</label>

                                                        <input type="radio" class="btn-check" name="chartType"
                                                            id="btn_pdf" autocomplete="off"
                                                            onclick="switchChart('pdf')">
                                                        <label class="btn btn-outline-warning" for="btn_pdf">PDF
                                                            f(t)</label>
                                                    </div>
                                                </div>

                                                <div id="plot_area" style="width:100%; height:400px;">
                                                    <!-- Plotly Chart -->
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 結論區塊 (Conclusion Panel) -->
                                        <div class="row mt-4">
                                            <div class="col-12">
                                                <div class="alert glass-card border-info" role="alert"
                                                    id="conclusion_panel" style="display: none;">
                                                    <h6 class="alert-heading fw-bold text-info"><i
                                                            class="bi bi-lightbulb-fill me-2"></i>分析結論 (Conclusion)</h6>
                                                    <p class="mb-0 text-light" id="conclusion_text"
                                                        style="line-height: 1.6; font-size: 0.95rem;">
                                                        <!-- JS will inject text here -->
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bootstrap JS -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
            <!-- Custom JS -->
            <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>